<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Ewan Croft" />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="msapplication-TileColor" content="#0a1607" />
    <meta
      name="msapplication-TileImage"
      content="%sveltekit.assets%/favicon/ms-icon-144x144.png"
    />

    <!-- Preload critical fonts -->
    <link 
      rel="preload" 
      href="%sveltekit.assets%/fonts/ArrowType-Recursive-1.085/Recursive_Web/woff2_variable/Recursive_VF_1.085.woff2" 
      as="font" 
      type="font/woff2" 
      crossorigin
    />

    <!-- THEME LOADER - MUST BE FIRST SCRIPT -->
    <script src="%sveltekit.assets%/scripts/themeLoader.js"></script>

    <!-- Service Worker Registration -->
    <script>
      // Enhanced debugging for service worker registration
      console.log('üîç Service Worker registration script loaded');
      console.log('üìç Current location:', window.location.href);
      console.log('üåê Protocol:', window.location.protocol);
      console.log('üè† Hostname:', window.location.hostname);
      
      if ('serviceWorker' in navigator) {
        console.log('‚úÖ Service Worker API supported');
        
        // Check for existing service workers
        navigator.serviceWorker.getRegistrations().then(registrations => {
          console.log('üìã Existing service worker registrations:', registrations.length);
          registrations.forEach((registration, index) => {
            console.log(`  ${index + 1}. Scope: ${registration.scope}, Active: ${!!registration.active}`);
          });
        });
        
        window.addEventListener('load', () => {
          console.log('üöÄ Page loaded, attempting to register service worker at /scripts/sw.js');
          
          // Test if the service worker file is accessible
          fetch('/scripts/sw.js')
            .then(response => {
              console.log('‚úÖ Service worker file accessible:', {
                status: response.status,
                statusText: response.statusText,
                url: response.url
              });
            })
            .catch(error => {
              console.error('‚ùå Service worker file not accessible:', error);
            });
          
          navigator.serviceWorker.register('/scripts/sw.js')
            .then((registration) => {
              console.log('‚úÖ Service Worker registered successfully:', {
                scope: registration.scope,
                active: !!registration.active,
                waiting: !!registration.waiting,
                installing: !!registration.installing
              });
              
              // Listen for updates
              registration.addEventListener('updatefound', () => {
                console.log('üîÑ Service Worker update found');
                const newWorker = registration.installing;
                
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('üÜï New Service Worker installed and ready');
                  }
                });
              });
            })
            .catch((registrationError) => {
              console.error('‚ùå Service Worker registration failed:', {
                error: registrationError.message,
                name: registrationError.name,
                stack: registrationError.stack
              });
              
              // Log additional debugging info
              console.log('üîç Debug info:', {
                location: window.location.href,
                userAgent: navigator.userAgent,
                serviceWorkerSupported: 'serviceWorker' in navigator,
                https: window.location.protocol === 'https:',
                localhost: window.location.hostname === 'localhost'
              });
            });
        });
      } else {
        console.warn('‚ö†Ô∏è Service Worker not supported in this browser');
      }
    </script>

    <!-- Favicon and Icons -->
    <link rel="icon" href="%sveltekit.assets%/favicon/favicon-32x32.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="%sveltekit.assets%/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="%sveltekit.assets%/favicon/favicon-16x16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="%sveltekit.assets%/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="%sveltekit.assets%/favicon/android-chrome-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="%sveltekit.assets%/favicon/android-chrome-512x512.png"
    />
    <link rel="manifest" href="%sveltekit.assets%/favicon/site.webmanifest" />

    %sveltekit.head%
  </head>
  <body data-sveltekit-preload-data="hover">
    <div style="display: contents">%sveltekit.body%</div>
  </body>
</html>